generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum HospitalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ConsultationMode {
  ONLINE
  OFFLINE
  BOTH
}

enum BookingStatus {
  HOLD
  CONFIRMED
  CANCELLED
  EXPIRED
}

enum OnboardingStage {
  PHONE_VERIFICATION
  PROFILE_SETUP
  COMPLETED
}

enum UserStatus {
  ACTIVE
  BLOCKED
  DELETED
}

enum BloodGroup {
  A_POS
  A_NEG
  B_POS
  B_NEG
  AB_POS
  AB_NEG
  O_POS
  O_NEG
}

model Hospital {
  id               Int              @id @default(autoincrement())
  name             String
  location         String
  place            String?
  imageUrl         String?
  pinCode          String
  contactName      String?
  contactNumber    String?
  ownerEmail       String           @unique
  ownerPassword    String
  speciality       String?
  consultationMode ConsultationMode @default(BOTH)
  status           HospitalStatus   @default(PENDING)
  createdAt        DateTime         @default(now())
  isListed         Boolean          @default(true)
  isOpen           Boolean          @default(true)
  latitude         Float?
  longitude        Float?

  categories    Category[]
  doctors       Doctor[]
  notifications Notification[]
}

model Category {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  imageUrl    String?
  hospitalId  Int
  createdAt   DateTime @default(now())

  hospital Hospital  @relation(fields: [hospitalId], references: [id])
  doctors  Doctor[]
  symptoms Symptom[]
}

model Doctor {
  id              Int      @id @default(autoincrement())
  name            String
  imageUrl        String?
  experience      Int
  specialization  String?
  qualification   String?
  about           String?
  categoryId      Int
  hospitalId      Int
  createdAt       DateTime @default(now())
  consultationFee Int      @default(0)
  languages       String[] @default([])

  category  Category   @relation(fields: [categoryId], references: [id])
  hospital  Hospital   @relation(fields: [hospitalId], references: [id])
  timeSlots TimeSlot[]
}

model User {
  id                    Int              @id @default(autoincrement())
  phone                 String           @unique
  email                 String?          @unique
  password              String?
  termsAccepted         Boolean          @default(false)
  acceptedAt            DateTime?
  status                UserStatus       @default(ACTIVE)
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  isPhoneVerified       Boolean          @default(false)
  onboardingStage       OnboardingStage?
  otpCode               String?
  otpExpiresAt          DateTime?
  refreshToken          String?
  bloodGroup            BloodGroup?
  emContactName         String?
  emContactNumber       String?
  fullName              String?
  isOnboardingCompleted Boolean          @default(false)

  bookings        Booking[]
  notifications   Notification[]
  patientProfiles PatientProfile[]
}

model PatientProfile {
  id     Int @id @default(autoincrement())
  userId Int

  fullName String
  phone    String?
  age      Int?
  gender   String?
  isSelf   Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     User      @relation(fields: [userId], references: [id])
  bookings Booking[]

  @@index([userId])
}

model TimeSlot {
  id               Int              @id @default(autoincrement())
  doctorId         Int
  start            DateTime
  end              DateTime
  consultationMode ConsultationMode @default(BOTH)
  isActive         Boolean          @default(true)
  createdAt        DateTime         @default(now())

  doctor  Doctor   @relation(fields: [doctorId], references: [id])
  booking Booking? @relation("SlotBooking")

  @@index([doctorId, start])
}

model Booking {
  id               Int @id @default(autoincrement())
  timeslotId       Int @unique
  userId           Int
  doctorId         Int
  patientProfileId Int

  start     DateTime
  end       DateTime
  status    BookingStatus @default(HOLD)
  expiresAt DateTime

  createdAt DateTime @default(now())

  // ðŸ”¹ relations
  user           User           @relation(fields: [userId], references: [id])
  patientProfile PatientProfile @relation(fields: [patientProfileId], references: [id])
  timeSlot       TimeSlot       @relation("SlotBooking", fields: [timeslotId], references: [id])

  notification Notification? @relation("BookingNotification")
}

model Notification {
  id         Int  @id @default(autoincrement())
  userId     Int?
  hospitalId Int
  bookingId  Int  @unique

  doctorName   String
  hospitalName String
  userName     String?
  userPhone    String?
  slotStart    DateTime
  slotEnd      DateTime

  createdAt DateTime @default(now())
  read      Boolean  @default(false)

  booking  Booking  @relation("BookingNotification", fields: [bookingId], references: [id])
  hospital Hospital @relation(fields: [hospitalId], references: [id])
  user     User?    @relation(fields: [userId], references: [id])

  @@index([hospitalId])
  @@index([userId])
}

model Symptom {
  id         Int      @id @default(autoincrement())
  name       String
  imageUrl   String?
  categoryId Int
  createdAt  DateTime @default(now())

  category Category @relation(fields: [categoryId], references: [id])
}
