generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Hospital {
  id               Int              @id @default(autoincrement())
  name             String
  location         String
  place            String?
  imageUrl         String?
  pinCode          String
  contactName      String?
  contactNumber    String?
  ownerEmail       String           @unique
  ownerPassword    String
  speciality       String?
  consultationMode ConsultationMode @default(BOTH)
  status           HospitalStatus   @default(PENDING)
  createdAt        DateTime         @default(now())
  isListed         Boolean          @default(true)
  isOpen           Boolean          @default(true)
  latitude         Float?
  longitude        Float?

  establishedYear Int?              // âœ… ADD THIS LINE

  categories       Category[]
  doctors          Doctor[]
  notifications    Notification[]
}


model Category {
  id          Int       @id @default(autoincrement())
  name        String
  description String?
  imageUrl    String?
  hospitalId  Int
  createdAt   DateTime  @default(now())
  hospital    Hospital  @relation(fields: [hospitalId], references: [id])
  doctors     Doctor[]
  symptoms    Symptom[]
}

model Doctor {
  id              Int        @id @default(autoincrement())
  name            String
  imageUrl        String?
  experience      Int
  specialization  String?
  qualification   String?
  about           String?
  categoryId      Int
  hospitalId      Int
  createdAt       DateTime   @default(now())
  consultationFee Int        @default(0)
  languages       String[]   @default([])
  category        Category   @relation(fields: [categoryId], references: [id])
  hospital        Hospital   @relation(fields: [hospitalId], references: [id])
  timeSlots       TimeSlot[]
}

model User {
  id                    Int              @id @default(autoincrement())
  phone                 String           @unique
  email                 String?          @unique
  password              String?
  termsAccepted         Boolean          @default(false)
  acceptedAt            DateTime?
  status                UserStatus       @default(ACTIVE)
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  isPhoneVerified       Boolean          @default(false)
  onboardingStage       OnboardingStage?
  otpCode               String?
  otpExpiresAt          DateTime?
  refreshToken          String?
  bloodGroup            BloodGroup?
  emContactName         String?
  emContactNumber       String?
  fullName              String?
  isOnboardingCompleted Boolean          @default(false)
  bookings              Booking[]
  notifications         Notification[]
  patientProfiles       PatientProfile[]
}

model PatientProfile {
  id        Int       @id @default(autoincrement())
  userId    Int
  fullName  String
  phone     String?
  age       Int?
  gender    String?
  isSelf    Boolean   @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  bookings  Booking[]
  user      User      @relation(fields: [userId], references: [id])

  @@index([userId])
}

model TimeSlot {
  id               Int              @id @default(autoincrement())
  doctorId         Int
  start            DateTime
  end              DateTime
  consultationMode ConsultationMode @default(BOTH)
  isActive         Boolean          @default(true)
  createdAt        DateTime         @default(now())
  booking          Booking?         @relation("SlotBooking")
  doctor           Doctor           @relation(fields: [doctorId], references: [id])

  @@index([doctorId, start])
}

model Booking {
  id               Int             @id @default(autoincrement())
  timeslotId       Int             @unique
  createdAt        DateTime        @default(now())
  doctorId         Int
  end              DateTime
  start            DateTime
  userId           Int
  patientProfileId Int?
  status           BookingStatus   @default(CONFIRMED)
  expiresAt        DateTime?       @db.Timestamp(6)
  patientProfile   PatientProfile? @relation(fields: [patientProfileId], references: [id])
  timeSlot         TimeSlot        @relation("SlotBooking", fields: [timeslotId], references: [id])
  user             User            @relation(fields: [userId], references: [id])
  notification     Notification?   @relation("BookingNotification")

  @@index([userId])
}

model Notification {
  id           Int      @id @default(autoincrement())
  userId       Int?
  hospitalId   Int
  bookingId    Int      @unique
  doctorName   String
  hospitalName String
  userName     String?
  userPhone    String?
  slotStart    DateTime
  slotEnd      DateTime
  createdAt    DateTime @default(now())
  read         Boolean  @default(false)
  booking      Booking  @relation("BookingNotification", fields: [bookingId], references: [id])
  hospital     Hospital @relation(fields: [hospitalId], references: [id])
  user         User?    @relation(fields: [userId], references: [id])
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model Symptom {
  id         Int      @id @default(autoincrement())
  name       String
  imageUrl   String?
  categoryId Int
  createdAt  DateTime @default(now())
}


enum HospitalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ConsultationMode {
  ONLINE
  OFFLINE
  BOTH
}

enum BookingStatus {
  CONFIRMED
  CANCELLED
  HOLD
  EXPIRED
}

enum OnboardingStage {
  PHONE_VERIFICATION
  PROFILE_SETUP
  COMPLETED
}

enum UserStatus {
  ACTIVE
  BLOCKED
  DELETED
}

enum BloodGroup {
  A_POS
  A_NEG
  B_POS
  B_NEG
  AB_POS
  AB_NEG
  O_POS
  O_NEG
}
