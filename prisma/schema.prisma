generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Hospital {
  id                   Int              @id @default(autoincrement())
  name                 String
  location             String
  place                String?
  imageUrl             String?
  pinCode              String
  contactName          String?
  contactNumber        String?
  ownerEmail           String           @unique
  ownerPassword        String
  speciality           String?
  consultationMode     ConsultationMode @default(BOTH)
  status               HospitalStatus   @default(PENDING)
  createdAt            DateTime         @default(now())
  isListed             Boolean          @default(true)
  isOpen               Boolean          @default(true)
  latitude             Float?
  longitude            Float?
  establishedYear      Int?
  state                String?
  city                 String?
  open24x7             Boolean?         @default(false)
  rating               Float?           @default(0)
  popularity           Int?             @default(0)
  isWomenFriendly      Boolean?         @default(false)
  hasMaternityCare     Boolean?         @default(false)
  isEmergencySupported Boolean?         @default(false)
  categories           Category[]
  doctors              Doctor[]
  notifications        Notification[]
}

model Category {
  id              Int       @id @default(autoincrement())
  name            String
  description     String?
  imageUrl        String?
  hospitalId      Int
  createdAt       DateTime  @default(now())
  isWomenSpecific Boolean?  @default(false)
  hospital        Hospital  @relation(fields: [hospitalId], references: [id])
  doctors         Doctor[]
  symptoms        Symptom[]
}

model Doctor {
  id                 Int                  @id @default(autoincrement())
  name               String
  imageUrl           String?
  experience         Int
  specialization     String?
  qualification      String?
  about              String?
  categoryId         Int
  hospitalId         Int
  createdAt          DateTime             @default(now())
  consultationFee    Int                  @default(0)
  languages          String[]             @default([])
  rating             Decimal?             @default(0) @db.Decimal(2, 1)
  isfavorite         Boolean?             @default(false)
  consultationMode   ConsultationMode     @default(BOTH)
  genderPreference   GenderPreference?    @default(ALL)
  category           Category             @relation(fields: [categoryId], references: [id])
  hospital           Hospital             @relation(fields: [hospitalId], references: [id])
  DoctorAvailability DoctorAvailability[]
  DoctorSymptom      DoctorSymptom[]
  timeSlots          TimeSlot[]
}

model User {
  id                    Int              @id @default(autoincrement())
  phone                 String?          @unique
  email                 String?          @unique
  password              String?
  termsAccepted         Boolean          @default(false)
  acceptedAt            DateTime?
  status                UserStatus       @default(ACTIVE)
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  isPhoneVerified       Boolean          @default(false)
  onboardingStage       OnboardingStage?
  otpCode               String?
  otpExpiresAt          DateTime?
  refreshToken          String?
  bloodGroup            BloodGroup?
  emContactName         String?
  emContactNumber       String?
  fullName              String?
  isOnboardingCompleted Boolean          @default(false)
  bookings              Booking[]
  labBookings           LabBooking[]
  notifications         Notification[]
  patientProfiles       PatientProfile[]
  reminders             Reminder[]
  LabCart               LabCart[]
}

model PatientProfile {
  id        Int      @id @default(autoincrement())
  userId    Int
  fullName  String
  phone     String?
  age       Int?
  gender    String?
  isSelf    Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  email     String?
  dob       DateTime?
}


model TimeSlot {
  id               Int              @id @default(autoincrement())
  doctorId         Int
  start            DateTime
  end              DateTime
  consultationMode ConsultationMode @default(BOTH)
  isActive         Boolean          @default(true)
  createdAt        DateTime         @default(now())
  booking          Booking?
  doctor           Doctor           @relation(fields: [doctorId], references: [id])

  @@index([doctorId, start])
}

model Booking {
  id               Int             @id @default(autoincrement())
  timeslotId       Int             @unique
  createdAt        DateTime        @default(now())
  doctorId         Int
  end              DateTime
  start            DateTime
  userId           Int
  patientProfileId Int?
  status           BookingStatus   @default(PENDING)
  expiresAt        DateTime?       @db.Timestamp(6)
  reason           String?
  patientProfile   PatientProfile? @relation(fields: [patientProfileId], references: [id])
  timeSlot         TimeSlot        @relation(fields: [timeslotId], references: [id], onUpdate: NoAction)
  user             User            @relation(fields: [userId], references: [id])
  notification     Notification?   @relation("BookingNotification")

  @@index([userId])
}

model Notification {
  id           Int      @id @default(autoincrement())
  userId       Int?
  hospitalId   Int
  bookingId    Int      @unique
  doctorName   String
  hospitalName String
  userName     String?
  userPhone    String?
  slotStart    DateTime
  slotEnd      DateTime
  createdAt    DateTime @default(now())
  read         Boolean  @default(false)
  booking      Booking  @relation("BookingNotification", fields: [bookingId], references: [id])
  hospital     Hospital @relation(fields: [hospitalId], references: [id])
  user         User?    @relation(fields: [userId], references: [id])
}

model Symptom {
  id              Int             @id @default(autoincrement())
  name            String
  imageUrl        String?
  categoryId      Int
  createdAt       DateTime        @default(now())
  isWomenSpecific Boolean?        @default(false)
  isCritical      Boolean?        @default(false)
  DoctorSymptom   DoctorSymptom[]
  Category        Category        @relation(fields: [categoryId], references: [id])
}

model DoctorAvailability {
  id        Int      @id @default(autoincrement())
  doctorId  Int
  date      DateTime
  startTime String
  endTime   String
  isBooked  Boolean  @default(false)
  doctor    Doctor   @relation(fields: [doctorId], references: [id])

  @@index([doctorId, date])
}

model Lab {
  id          Int      @id @default(autoincrement())
  name        String
  imageUrl    String?
  description String?
  phone       String?
  address     String?
  city        String?
  state       String?
  latitude    Float?
  longitude   Float?
  isOpen      Boolean  @default(true)
  rating      Float    @default(0)
  createdAt   DateTime @default(now())

  bookings   LabBooking[]
  categories LabCategory[]
  tests      LabTest[]
  slots      LabSlot[] // âœ… ADD THIS
  LabCart    LabCart[]
}

model LabCategory {
  id        Int       @id @default(autoincrement())
  name      String
  labId     Int
  createdAt DateTime  @default(now())
  lab       Lab       @relation(fields: [labId], references: [id])
  tests     LabTest[]
}

model LabTest {
  id          Int     @id @default(autoincrement())
  labId       Int
  categoryId  Int
  name        String
  description String?
  price       Int
  reportTime  String
  isAvailable Boolean @default(true)

  minAge Int @default(0)
  maxAge Int @default(120)

  lab      Lab          @relation(fields: [labId], references: [id])
  category LabCategory  @relation(fields: [categoryId], references: [id])
  bookings LabBooking[]
  LabCart  LabCart[]
}

model LabBooking {
  id        Int @id @default(autoincrement())
  userId    Int
  labId     Int
  labTestId Int

  status         LabBookingStatus @default(PENDING)
  sampleDate     DateTime
  collectedAt    DateTime?
  reportIssuedAt DateTime?

  createdAt DateTime @default(now())

  lab     Lab     @relation(fields: [labId], references: [id])
  labTest LabTest @relation(fields: [labTestId], references: [id])
  user    User    @relation(fields: [userId], references: [id])

  report   LabReport?
  feedback LabFeedback?
}

model LabReport {
  id           Int @id @default(autoincrement())
  labBookingId Int @unique

  reportStatus ReportStatus
  summary      String?

  reportUrls String[]
  samples    String[]

  createdAt DateTime @default(now())

  labBooking LabBooking @relation(fields: [labBookingId], references: [id])
}

model LabCart {
  id        Int      @id @default(autoincrement())
  userId    Int
  labId     Int
  labTestId Int
  quantity  Int      @default(1)
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id])
  lab     Lab     @relation(fields: [labId], references: [id])
  labTest LabTest @relation(fields: [labTestId], references: [id])

  @@unique([userId, labTestId])
}

model LabFeedback {
  id        Int     @id @default(autoincrement())
  bookingId Int     @unique
  rating    Int
  comment   String?

  booking LabBooking @relation(fields: [bookingId], references: [id])
}

model LabSlot {
  id        Int      @id @default(autoincrement())
  labId     Int
  date      DateTime
  startTime String
  endTime   String
  isBooked  Boolean  @default(false)
  createdAt DateTime @default(now())

  lab Lab @relation(fields: [labId], references: [id])

  @@index([labId, date])
}

model DoctorSymptom {
  id        Int     @id @default(autoincrement())
  doctorId  Int
  symptomId Int
  Doctor    Doctor  @relation(fields: [doctorId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "DoctorSymptom_doctor_fkey")
  Symptom   Symptom @relation(fields: [symptomId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "DoctorSymptom_symptom_fkey")

  @@unique([doctorId, symptomId], map: "DoctorSymptom_unique")
}

model Reminder {
  id          Int            @id @default(autoincrement())
  userId      Int
  type        ReminderType
  title       String
  reminderAt  DateTime
  repeat      ReminderRepeat @default(NONE)
  notes       String?
  isImportant Boolean        @default(false)
  status      ReminderStatus @default(ACTIVE)
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  user        User           @relation(fields: [userId], references: [id])

  @@index([userId, reminderAt])
}

enum HospitalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ConsultationMode {
  ONLINE
  OFFLINE
  BOTH
}

enum BookingStatus {
  PENDING
  SAMPLE_COLLECTED
  COMPLETED
  CANCELLED
}

enum ReportStatus {
  NORMAL
  ABNORMAL
  BORDERLINE
}

enum OnboardingStage {
  PHONE_VERIFICATION
  PROFILE_SETUP
  COMPLETED
}

enum UserStatus {
  ACTIVE
  BLOCKED
  DELETED
}

enum BloodGroup {
  A_POS
  A_NEG
  B_POS
  B_NEG
  AB_POS
  AB_NEG
  O_POS
  O_NEG
}

enum LabBookingStatus {
  PENDING
  SAMPLE_COLLECTED
  COMPLETED
  CANCELLED
}

enum GenderPreference {
  FEMALE
  MALE
  ALL
}

enum ReminderType {
  MEDICINE
  APPOINTMENT
  TEST
  CUSTOM
}

enum ReminderRepeat {
  NONE
  DAILY
  WEEKLY
  MONTHLY
}

enum ReminderStatus {
  ACTIVE
  COMPLETED
  SKIPPED
  EXPIRED
}
